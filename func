//{[+]EFSOL, Козлов Максим 28.11.2018 16:57:00
//Установка отборов в форму выбора. При создании нового элемента с формы выбора - новый элемент заполняется значениями отборов
//Но это не точно
&НаКлиенте
Процедура ЭР_СервисныйДоговорНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Если ЗначениеЗаполнено(Объект.ЭР_СервисныйПодрядчик) Тогда
		ОтборВладелец = Новый ПараметрВыбора("Отбор.Владелец", Объект.ЭР_СервисныйПодрядчик);
		ОтборОрганизация = Новый ПараметрВыбора("Отбор.Организация", Объект.Организация);
		ОтборТип = Новый ПараметрВыбора("Отбор.ВидДоговора", ПредопределенноеЗначение("Перечисление.ВидыДоговоровКонтрагентов.СПоставщиком"));
		НовыйМассив = Новый Массив();
		НовыйМассив.Добавить(ОтборВладелец);
		НовыйМассив.Добавить(ОтборОрганизация);
		НовыйМассив.Добавить(ОтборТип);
		НовыеПараметры = Новый ФиксированныйМассив(НовыйМассив);
		Элементы.ЭР_СервисныйДоговор.ПараметрыВыбора = НовыеПараметры;
	Иначе
		Элементы.ЭР_СервисныйДоговор.ПараметрыВыбора = Новый ФиксированныйМассив (Новый Массив);
	КонецЕсли; 
КонецПроцедуры
//}28.11.2018 16:57:00 EFSOL

----------------------------------------------------------------------------------------
//Очистка условного оформления по условию, добавление новых элементов УО 
&НаСервере
Процедура ДобавитьУсловноеОформлениеФормыСпискаЗаказНаТС(ЭтаФорма) Экспорт
	//{[+]EFSOL, Козлов Максим 28.02.2019 11:04:33
	УдаляемыеЭлементыУО = Новый Массив;
	Для каждого иЭлементУО Из ЭтаФорма.Условноеоформление.Элементы Цикл
		Если иЭлементУО.Поля.Элементы[0].Поле = Новый ПолеКомпоновкиДанных ("СтатусЗаказа") Тогда
		УдаляемыеЭлементыУО.Добавить(иЭлементУО);
		КонецЕсли;
	КонецЦикла;
	Для каждого иИндекс Из УдаляемыеЭлементыУО Цикл
		ЭтаФорма.Условноеоформление.Элементы.Удалить(иИндекс);
	КонецЦикла; 
	Список = ЭтаФорма.Список;
	СоответствиеИзменений = Новый Соответствие();
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Новый, Новый Структура("Текст, ЦветФона", "Забор от клиента", WebЦвета.Аквамарин));
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Открыт, Новый Структура("Текст, ЦветФона", "Груз на складе", WebЦвета.Красный));
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Размещен, Новый Структура("Текст, ЦветФона", "Груз на складе", WebЦвета.Желтый));
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Отправлен, Новый Структура("Текст, ЦветФона", "В пути", WebЦвета.СеребристоСерый));
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Доставлен, Новый Структура("Текст, ЦветФона", "Груз на складе", WebЦвета.СветлоЗеленый));
	СоответствиеИзменений.Вставить(Справочники.уатСтатусы_уэ.Закрыт, Новый Структура("Текст, ЦветФона", "Груз выдан", WebЦвета.РозовоКоричневый));
	
	Для каждого иСоответствие Из СоответствиеИзменений Цикл
		ЭлементУсловногоОформления = Список.УсловноеОформление.Элементы.Добавить();
		ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("СтатусЗаказа");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = иСоответствие.Ключ;
		
		Для каждого иСтрукт Из иСоответствие.Значение Цикл	
			ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра(иСтрукт.Ключ, иСтрукт.Значение);
		КонецЦикла;
		
		ПолеОформления = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
		ПолеОформления.Поле = Новый ПолеКомпоновкиДанных("СтатусЗаказа");
		ПолеОформления.Использование = Истина;

		ЭлементУсловногоОформления.РежимОтображения = РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Недоступный;
		ЭлементУсловногоОформления.ИдентификаторПользовательскойНастройки = "ПодменаСтатусов";
	КонецЦикла;	
	//}28.02.2019 11:04:33 EFSOL	
КонецПроцедуры

---------------------------------------------------------------------------------
НачатьТранзакцию();
Попытка
    ДелаемЧтоТо();
    ЗафиксироватьТранзакцию();
Исключение
    Если ТранзакцияАктивна() Тогда
        ОтменитьТранзакцию();
    КонецЕсли;
    ВызватьИсключение;
КонецПопытки;
---------------------------------------------------------------------------------
